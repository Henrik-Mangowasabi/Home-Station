<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Maison</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="refresh" content="1800">

    <style>
        /* --- 1. STRUCTURE G√âN√âRALE --- */
        body {
            background-color: #000;
            color: #fff;
            font-family: -apple-system, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            height: 96vh;
            display: grid;
            gap: 15px;
            /* GRILLE : 1/3 √† gauche, 2/3 √† droite */
            grid-template-columns: 1fr 2fr; 
            grid-template-rows: 1fr 1fr 1fr;
            grid-template-areas:
                "panel-left  panel-agenda"
                "panel-left  panel-tempo"
                "panel-left  panel-conso";
        }

        /* --- 2. STYLE DES BOITES (CARDS) --- */
        .card {
            background-color: #1c1c1e;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* --- 3. CONTENU GAUCHE (M√âT√âO D√âTAILL√âE) --- */
        .panel-left {
            grid-area: panel-left;
            display: flex;
            flex-direction: column;
            gap: 15px; /* Espace entre les blocs internes */
        }

        /* BLOC HEURE */
        .header-time {
            text-align: center;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 5px;
        }
        #clock { font-size: 50px; font-weight: bold; line-height: 1; letter-spacing: 2px;}
        #date { font-size: 16px; color: #aaa; margin-top: 5px; text-transform: capitalize;}

        /* BLOC M√âT√âO ACTUELLE (Votre demande pr√©cise) */
        .weather-now-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 colonnes */
            gap: 5px;
            align-items: center;
            background: #2c2c2e;
            padding: 15px;
            border-radius: 15px;
        }
        /* Icone Soleil √† gauche */
        .wn-icon { font-size: 50px; text-align: center; } 
        /* Temp√©rature √† droite */
        .wn-temp { font-size: 40px; font-weight: bold; text-align: center; color: #fff; }
        /* Desc en dessous icone */
        .wn-desc { font-size: 14px; color: #aaa; text-align: center; grid-column: 1; }
        /* Pluie & Lune en dessous Temp */
        .wn-details { 
            grid-column: 2; 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            font-size: 12px; 
            color: #888;
        }
        .rain-risk { color: #64d2ff; font-weight: bold; }

        /* BLOC 5 PROCHAINES HEURES */
        .next-hours {
            display: flex;
            justify-content: space-between;
            background: #2c2c2e;
            padding: 10px;
            border-radius: 15px;
        }
        .hour-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
        }
        .hc-time { color: #aaa; margin-bottom: 5px; }
        .hc-icon { font-size: 18px; margin-bottom: 5px; }
        .hc-temp { font-weight: bold; }

        /* BLOC CYCLE SOLEIL */
        .sun-cycle {
            background: #2c2c2e;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }
        .sun-times { display: flex; justify-content: space-between; font-size: 12px; color: #aaa; margin-bottom: 5px; }
        /* Barre de progression du soleil */
        .sun-bar-bg { width: 100%; height: 6px; background: #444; border-radius: 3px; position: relative; overflow: hidden; }
        .sun-bar-fill { height: 100%; background: orange; width: 0%; transition: width 1s; } /* JS changera la largeur */

        /* BLOC 5 PROCHAINS JOURS */
        .next-days {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1; /* Prend l'espace restant */
        }
        .day-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        .dr-name { width: 60px; font-weight: bold; color: #ddd; text-transform: capitalize;}
        .dr-icon { width: 30px; text-align: center; }
        .dr-temps { color: #aaa; font-size: 12px; }
        .dr-temps span { color: #fff; font-weight: bold; font-size: 14px; margin-left: 5px;}

        /* --- 4. ZONES DE DROITE (Vides pour l'instant) --- */
        .panel-agenda { grid-area: panel-agenda; background: #1c1c1e; border-radius: 20px; padding: 20px;}
        .panel-tempo { grid-area: panel-tempo; background: #1c1c1e; border-radius: 20px; padding: 20px;}
        .panel-conso { grid-area: panel-conso; background: #1c1c1e; border-radius: 20px; padding: 20px;}
        
        h2 { margin: 0; color: #555; font-size: 14px; text-transform: uppercase; margin-bottom: 10px; }

    </style>
</head>
<body>

    <div class="card panel-left">
        
        <div class="header-time">
            <div id="clock">--:--</div>
            <div id="date">Chargement...</div>
        </div>

        <div class="weather-now-grid">
            <div class="wn-icon" id="curr-icon">‚ùì</div>
            <div class="wn-temp" id="curr-temp">--¬∞</div>
            <div class="wn-desc" id="curr-desc">...</div>
            <div class="wn-details">
                <span id="rain-risk" class="rain-risk">üíß --%</span>
                <span id="moon-phase">üåë Lune</span>
            </div>
        </div>

        <div class="next-hours" id="hourly-container">
            <div style="font-size:10px; color:#666;">Chargement m√©t√©o...</div>
        </div>

        <div class="sun-cycle">
            <div class="sun-times">
                <span id="sunrise">--:--</span>
                <span style="color:orange;">Soleil</span>
                <span id="sunset">--:--</span>
            </div>
            <div class="sun-bar-bg">
                <div class="sun-bar-fill" id="sun-progress"></div>
            </div>
        </div>

        <div class="next-days" id="daily-container">
            </div>

    </div>


    <div class="panel-agenda">
        <h2>Agenda</h2>
        <p style="color:#555;">(On s'occupera de √ßa apr√®s)</p>
    </div>

    <div class="panel-tempo">
        <h2>Tempo</h2>
        <p style="color:#555;">(Zone vide)</p>
    </div>

    <div class="panel-conso">
        <h2>Conso</h2>
        <p style="color:#555;">(Zone vide)</p>
    </div>


    <script>
        // --- 1. GESTION HEURE & DATE ---
        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('fr-FR', {hour: '2-digit', minute:'2-digit'});
            const dateStr = now.toLocaleDateString('fr-FR', {weekday: 'long', day: 'numeric', month: 'long'});
            
            document.getElementById('clock').textContent = timeStr;
            document.getElementById('date').textContent = dateStr;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- 2. GESTION M√âT√âO (Beaupr√©au-en-Mauges) ---
        // Coordonn√©es : 47.20, -0.99
        function fetchWeather() {
            // On utilise une API gratuite (Open-Meteo) sans cl√©
            const url = "https://api.open-meteo.com/v1/forecast?latitude=47.20&longitude=-0.99&current=temperature_2m,is_day,precipitation,weather_code&hourly=temperature_2m,precipitation_probability,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_probability_max&timezone=Europe%2FParis";

            const xhr = new XMLHttpRequest();
            xhr.open("GET", url);
            xhr.onload = function() {
                if (xhr.status === 200) {
                    const data = JSON.parse(xhr.responseText);
                    updateWeatherUI(data);
                }
            };
            xhr.send();
        }

        // CODES WMO (Pour transformer les codes 0, 1, 2... en Icones)
        function getWeatherIcon(code, isDay) {
            const icons = {
                0: "‚òÄÔ∏è", 1: "üå§", 2: "‚òÅÔ∏è", 3: "‚òÅÔ∏è", // Clair / Nuageux
                45: "üå´", 48: "üå´", // Brouillard
                51: "üå¶", 53: "üåß", 55: "üåß", // Bruine
                61: "üåß", 63: "üåß", 65: "üåß", // Pluie
                71: "‚ùÑÔ∏è", 73: "‚ùÑÔ∏è", 75: "‚ùÑÔ∏è", // Neige
                80: "üå¶", 81: "üåß", 82: "‚õà", // Averses
                95: "‚ö°Ô∏è", 96: "‚õà", 99: "‚õà"  // Orage
            };
            let icon = icons[code] || "‚ùì";
            if (!isDay && (code === 0 || code === 1)) icon = "üåô"; // Lune si nuit claire
            return icon;
        }
        
        function getWeatherDesc(code) {
            const descs = { 0:"Ensoleill√©", 1:"Peu nuageux", 2:"Nuageux", 3:"Couvert", 45:"Brouillard", 61:"Pluie", 80:"Averses", 95:"Orage" };
            return descs[code] || "Variable";
        }

        function updateWeatherUI(data) {
            const current = data.current;
            const daily = data.daily;
            const hourly = data.hourly;

            // --- A. METEO ACTUELLE ---
            document.getElementById('curr-temp').textContent = Math.round(current.temperature_2m) + "¬∞";
            document.getElementById('curr-icon').textContent = getWeatherIcon(current.weather_code, current.is_day);
            document.getElementById('curr-desc').textContent = getWeatherDesc(current.weather_code);
            // Risque pluie (du jour ou de l'heure ?) On prend le max du jour pour √™tre prudent
            document.getElementById('rain-risk').textContent = "üíß " + daily.precipitation_probability_max[0] + "%";
            
            // Phase Lunaire (Simulation simple bas√©e sur la date car l'API complexe requiert du calcul)
            // On affiche une ic√¥ne lune simple pour le style demand√©
            document.getElementById('moon-phase').textContent = getMoonPhase();

            // --- B. 5 PROCHAINES HEURES ---
            const hContainer = document.getElementById('hourly-container');
            hContainer.innerHTML = ""; // Vider
            // On prend l'heure actuelle comme point de d√©part
            const currentHourIndex = new Date().getHours();
            
            for(let i = 0; i < 5; i++) {
                // L'index dans le tableau hourly correspond souvent √† l'heure (0 = minuit)
                // Attention : l'API renvoie parfois 24h ou plus. On cible l'heure juste apr√®s.
                let index = currentHourIndex + i; 
                // S√©curit√© si on d√©passe minuit
                if(index > 23) index = index - 24; 

                const hTemp = Math.round(hourly.temperature_2m[index]);
                const hIcon = getWeatherIcon(hourly.weather_code[index], 1); // Force jour pour lisibilit√©
                const timeLabel = index + "h";

                hContainer.innerHTML += `
                <div class="hour-col">
                    <span class="hc-time">${timeLabel}</span>
                    <span class="hc-icon">${hIcon}</span>
                    <span class="hc-temp">${hTemp}¬∞</span>
                </div>`;
            }

            // --- C. CYCLE SOLEIL ---
            const sunrise = new Date(daily.sunrise[0]);
            const sunset = new Date(daily.sunset[0]);
            const now = new Date();
            
            // Affichage Heures
            const formatTime = (date) => date.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('sunrise').textContent = "Lever " + formatTime(sunrise);
            document.getElementById('sunset').textContent = "Coucher " + formatTime(sunset);

            // Barre de progression
            let percent = 0;
            if (now > sunset) percent = 100;
            else if (now < sunrise) percent = 0;
            else {
                const totalMinutes = (sunset - sunrise);
                const currentMinutes = (now - sunrise);
                percent = (currentMinutes / totalMinutes) * 100;
            }
            document.getElementById('sun-progress').style.width = percent + "%";


            // --- D. 5 PROCHAINS JOURS ---
            const dContainer = document.getElementById('daily-container');
            dContainer.innerHTML = "";
            
            for(let i = 1; i <= 5; i++) { // On commence √† 1 pour "demain"
                const dateObj = new Date(daily.time[i]);
                const dayName = dateObj.toLocaleDateString('fr-FR', {weekday:'short'});
                const dateNum = dateObj.getDate();
                
                const dIcon = getWeatherIcon(daily.weather_code[i], 1);
                const minT = Math.round(daily.temperature_2m_min[i]);
                const maxT = Math.round(daily.temperature_2m_max[i]);

                dContainer.innerHTML += `
                <div class="day-row">
                    <span class="dr-name">${dayName} ${dateNum}</span>
                    <span class="dr-icon">${dIcon}</span>
                    <div class="dr-temps">
                        Matin ${minT}¬∞ <span>${maxT}¬∞</span>
                    </div>
                </div>`;
            }
        }

        // Petite fonction pour simuler la phase lunaire (approximatif)
        function getMoonPhase() {
            const date = new Date();
            const daysSinceNew = (date.getTime() - new Date(2023, 0, 21).getTime()) / 86400000 % 29.53;
            if (daysSinceNew < 3.7) return "üåë Nouv.";
            if (daysSinceNew < 7.4) return "üåí Mont.";
            if (daysSinceNew < 11.1) return "üåì 1er Q";
            if (daysSinceNew < 14.8) return "üåî Gibb.";
            if (daysSinceNew < 18.5) return "üåï Pleine";
            if (daysSinceNew < 22.2) return "üåñ Gibb.";
            if (daysSinceNew < 25.9) return "üåó Dern Q";
            return "üåò Desc.";
        }

        // Lancer la m√©t√©o au d√©marrage
        fetchWeather();
        // Relancer toutes les 30 min
        setInterval(fetchWeather, 1800000);

    </script>
</body>
</html>